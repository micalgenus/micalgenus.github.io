{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/articles/2019-03/Create-React-App-Jest-error-over-nodejs-11.11","result":{"data":{"site":{"siteMetadata":{"title":"GyeongSu Han's Github Pages","author":"@micalgenus","siteUrl":"https://micalgenus.github.io"}},"markdownRemark":{"id":"f911ba1e-8649-5b81-a299-741f449a7730","html":"<p>현재 Create React App(v2.1.8이하)을 사용할 경우 Jest에서 다음과 같은 에러가 발생한다. <a href=\"https://github.com/facebook/create-react-app/issues/6591\">이슈</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token assign-left variable\">CI</span><span class=\"token operator\">=</span>true <span class=\"token function\">yarn</span> <span class=\"token builtin class-name\">test</span>\n<span class=\"token function\">yarn</span> run v1.13.0\n$ react-scripts <span class=\"token builtin class-name\">test</span>\nFAIL src/App.test.js\n  ● Test suite failed to run\n\n    TypeError: Cannot assign to <span class=\"token builtin class-name\">read</span> only property <span class=\"token string\">'Symbol(Symbol.toStringTag)'</span> of object <span class=\"token string\">'#&lt;process>'</span>\n\n      at exports.default <span class=\"token punctuation\">(</span>node_modules/jest-util/build/create_process_object.js:15:34<span class=\"token punctuation\">)</span>\n\nTest Suites: <span class=\"token number\">1</span> failed, <span class=\"token number\">1</span> total\nTests:       <span class=\"token number\">0</span> total\nSnapshots:   <span class=\"token number\">0</span> total\nTime:        <span class=\"token number\">3</span>.291s\nRan all <span class=\"token builtin class-name\">test</span> suites.\nerror Command failed with <span class=\"token builtin class-name\">exit</span> code <span class=\"token number\">1</span>.\ninfo Visit https://yarnpkg.com/en/docs/cli/run <span class=\"token keyword\">for</span> documentation about this command.</code></pre></div>\n<p>이 에러를 따라가보면 Jest에서 <a href=\"https://github.com/facebook/jest/pull/8050\">다음</a>과 같이 해결하였다.</p>\n<p>우선 아래의 구문이 문제를 발생시킨다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">newProcess<span class=\"token punctuation\">[</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'process'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그렇기에 이를 다음과 같이 패치하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This fails on Node 12, but it's already set to 'process'</span>\n  newProcess<span class=\"token punctuation\">[</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'process'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Make sure it's actually set instead of potentially ignoring errors</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newProcess<span class=\"token punctuation\">[</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'process'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> <span class=\"token string\">'Unable to set toStringTag on process. Please open up an issue at https://github.com/facebook/jest\\n\\n'</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 문제가 발생한 이유를 살펴보면 <strong>node.js</strong>에서 <code class=\"language-text\">11.11</code>로 업데이트 할 때 다음과 같은 부분이 <a href=\"https://github.com/nodejs/node/commit/ccaebdef66f62775ff8cc5d6fa21881a883c08fc#diff-362950ada44657730d806a6908957c35\">추가</a>되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">,</span> Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  writable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  value<span class=\"token operator\">:</span> <span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>해당 부분을 보게되면, <strong>process</strong>객체에 <code class=\"language-text\">Symbol.toStringTag</code>멤버를 <code class=\"language-text\">writable: false</code>하게 정의하였기 때문에, Jest에서 문제가 발생하였다.</p>\n<p>그렇기에 <a href=\"https://github.com/facebook/jest/commit/800f2f803d01c8ae194d71b251e4965dd70e5bf2\">Jest v24.2.0-alpha.0</a>에서 패치가 되어 정상적으로 작동한다.</p>\n<p>하지만, 현재 <strong>create-react-app</strong>의 경우는 <strong>jest</strong>를 <code class=\"language-text\">23.6.0</code>을 사용하기 때문에 문제가 해결되지 않고 있다. 이를 해결할 <a href=\"https://github.com/facebook/create-react-app/pull/6278\">PR</a>이 있지만 아직 받아들여지지 않았다.</p>\n<p><strong>create-react-app</strong>을 사용하지 않을 경우에는, <strong>jest</strong>의 버전을 <code class=\"language-text\">v24.2.0-alpha.0</code>이후 버전으로 업데이트하면 문제를 해결할 수 있다.</p>\n<hr>\n<h3 id=\"20190426-추가\" style=\"position:relative;\"><a href=\"#20190426-%EC%B6%94%EA%B0%80\" aria-label=\"20190426 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2019.04.26 추가</h3>\n<p>Nodejs를 11.12버전에서 다음 문제를 해결하였다. <strong>readonly</strong>속성이였던 <code class=\"language-text\">Symbol.toStringTag</code>멤버가 <strong>writeable</strong>하게 변경되면서 CRA버전에 상관없이 문제가 발생하지 않는다.</p>","frontmatter":{"categories":["React"],"title":"Create React App Jest error over nodejs 11.11","date":"Mar 11, 2019","tags":["React","Jest","nodejs"]}}},"pageContext":{"comments":true,"previous":{"frontmatter":{"path":"/articles/2019-03/CSS-scrolling-animation","title":"CSS scrolling animation","comments":true}},"next":{"frontmatter":{"path":"/articles/2019-03/Docker-외부-접속-허용","title":"Docker 외부 접속 허용","comments":true}}}}}