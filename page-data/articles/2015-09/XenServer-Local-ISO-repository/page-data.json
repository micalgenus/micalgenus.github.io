{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/articles/2015-09/XenServer-Local-ISO-repository","result":{"data":{"site":{"siteMetadata":{"title":"GyeongSu Han's Github Pages","author":"@micalgenus","siteUrl":"https://micalgenus.github.io"}},"markdownRemark":{"id":"081b01e9-f0be-589c-aaee-d0e2da2be4df","html":"<p>참고: <a href=\"http://geekcorner.sitedevelopments.net/2013/03/29/create-local-iso-repository-xenserver-6/\">http://geekcorner.sitedevelopments.net/2013/03/29/create-local-iso-repository-xenserver-6/</a></p>\n<p>우선 Local ISO repository를 생성하기 전에 사용 가능한 Volume을 확인한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vgs</span>\n  VG                                                 <span class=\"token comment\">#PV #LV #SN Attr   VSize VFree</span>\n  VG_XenStorage-775f9a8c-d8a7-d90b-dd9d-8d0fd69d9dc6   <span class=\"token number\">1</span>   <span class=\"token number\">1</span>   <span class=\"token number\">0</span> wz--n- <span class=\"token number\">3</span>.99G <span class=\"token number\">3</span>.98G\n  VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb   <span class=\"token number\">2</span>  <span class=\"token number\">12</span>   <span class=\"token number\">0</span> wz--n- <span class=\"token number\">7</span>.27T <span class=\"token number\">6</span>.35T</code></pre></div>\n<p>현재 7.2T중 6.3T가 사용 가능하므로 이중 1T를 사용하도록 하겠다.</p>\n<p>디스크에서 공간을 할당해 주어야 하는데, 이 명령은 lvcreate를 이용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lvcreate -L 1T -n test VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb</span>\n  Logical volume <span class=\"token string\">\"test\"</span> created</code></pre></div>\n<p>이런 식으로 <code class=\"language-text\">-L</code>옵션을 통하여 크기를, <code class=\"language-text\">-n</code>옵션을 통하여 이름을 설정한 뒤, 사용할 Volume을 적게되면 해당하는 Volume에 생성되게 된다.</p>\n<p>lvs을 사용하여 확인을 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># lvs</span>\n  LV                                       VG                                                 Attr   LSize   Origin Snap%  Move Log Copy%  Convert\n  MGT                                      VG_XenStorage-775f9a8c-d8a7-d90b-dd9d-8d0fd69d9dc6 -wi---   <span class=\"token number\">4</span>.00M\n  MGT                                      VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi-a-   <span class=\"token number\">4</span>.00M\n  VHD-120e9fb2-c44c-49e1-b308-7df92730b80c VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi-ao  <span class=\"token number\">30</span>.07G\n  VHD-17266391-ce71-46bb-8f24-cf5717711af3 VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi---   <span class=\"token number\">8</span>.02G\n  VHD-306ad48e-5072-4363-82ba-999274a7e616 VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi---  <span class=\"token number\">25</span>.05G\n  VHD-3eaf8e2b-567e-4f5a-a3ad-514c1478f041 VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi-ao  <span class=\"token number\">64</span>.13G\n  VHD-62f887d6-7446-49bb-8bc8-396036ea5d3b VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi---   <span class=\"token number\">8</span>.02G\n  VHD-80b4d2f3-5612-49a2-962d-40403d33fd9c VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi-ao <span class=\"token number\">128</span>.26G\n  VHD-9f21884f-c8bf-4c1f-9705-d12a342ab154 VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi---  <span class=\"token number\">16</span>.04G\n  VHD-c43fdd45-aace-44aa-a7bf-66629e1eff8c VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi---  <span class=\"token number\">16</span>.00M\n  VHD-ef1e1815-0e9a-45d9-87e3-b392e96e7caa VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi---  <span class=\"token number\">25</span>.05G\n  VHD-f8684adf-9f72-4fd1-bd37-e9a1d73ee074 VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi-ao <span class=\"token number\">513</span>.01G\n  isoImage                                 VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi--- <span class=\"token number\">128</span>.00G\n  <span class=\"token builtin class-name\">test</span>                                     VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb -wi-ao   <span class=\"token number\">1</span>.00T</code></pre></div>\n<p>마지막 줄을 보게되면 해당하는 이름으로 생성된것을 확인할 수 있다. 이제 이를 사용하여야 하는데, 사용하기전 포맷을 하여야 한다.</p>\n<p>ext3타입으로 포맷후 사용할 것이기 때문에 <code class=\"language-text\">mkfs.ext3</code>를 사용하도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkfs.ext3 /dev/VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb/test</span>\n<span class=\"token function\">mke2fs</span> <span class=\"token number\">1.39</span> <span class=\"token punctuation\">(</span><span class=\"token number\">29</span>-May-2006<span class=\"token punctuation\">)</span>\nFilesystem <span class=\"token assign-left variable\">label</span><span class=\"token operator\">=</span>\nOS type: Linux\nBlock <span class=\"token assign-left variable\">size</span><span class=\"token operator\">=</span><span class=\"token number\">4096</span> <span class=\"token punctuation\">(</span>log<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\nFragment <span class=\"token assign-left variable\">size</span><span class=\"token operator\">=</span><span class=\"token number\">4096</span> <span class=\"token punctuation\">(</span>log<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">134217728</span> inodes, <span class=\"token number\">268435456</span> blocks\n<span class=\"token number\">13421772</span> blocks <span class=\"token punctuation\">(</span><span class=\"token number\">5.00</span>%<span class=\"token punctuation\">)</span> reserved <span class=\"token keyword\">for</span> the super user\nFirst data <span class=\"token assign-left variable\">block</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\nMaximum filesystem <span class=\"token assign-left variable\">blocks</span><span class=\"token operator\">=</span><span class=\"token number\">4294967296</span>\n<span class=\"token number\">8192</span> block <span class=\"token function\">groups</span>\n<span class=\"token number\">32768</span> blocks per group, <span class=\"token number\">32768</span> fragments per group\n<span class=\"token number\">16384</span> inodes per group\nSuperblock backups stored on blocks:\n    <span class=\"token number\">32768</span>, <span class=\"token number\">98304</span>, <span class=\"token number\">163840</span>, <span class=\"token number\">229376</span>, <span class=\"token number\">294912</span>, <span class=\"token number\">819200</span>, <span class=\"token number\">884736</span>, <span class=\"token number\">1605632</span>, <span class=\"token number\">2654208</span>,\n    <span class=\"token number\">4096000</span>, <span class=\"token number\">7962624</span>, <span class=\"token number\">11239424</span>, <span class=\"token number\">20480000</span>, <span class=\"token number\">23887872</span>, <span class=\"token number\">71663616</span>, <span class=\"token number\">78675968</span>,\n    <span class=\"token number\">102400000</span>, <span class=\"token number\">214990848</span>\n\nWriting inode tables: <span class=\"token keyword\">done</span>\nCreating journal <span class=\"token punctuation\">(</span><span class=\"token number\">32768</span> blocks<span class=\"token punctuation\">)</span>: <span class=\"token keyword\">done</span>\nWriting superblocks and filesystem accounting information: <span class=\"token keyword\">done</span>\n\nThis filesystem will be automatically checked every <span class=\"token number\">33</span> mounts or\n<span class=\"token number\">180</span> days, whichever comes first.  Use tune2fs -c or -i to override.</code></pre></div>\n<p>이런식으로 완료되게 된다.완료가 되었으면 사용할 수 있는데, 이를 사용하기 위해서는 우선 마운트를 시켜야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /mnt</span>\n<span class=\"token punctuation\">[</span>root@localhost mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p test</span>\n<span class=\"token punctuation\">[</span>root@localhost mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t ext3 /dev/VG_XenStorage-cd27bd82-61d4-1bb3-e5b6-1a1e9c57c7eb/test /mnt/test</span></code></pre></div>\n<p>이렇게 마운트까지 시키게 되었다면, df를 이용하여 확인해 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># df -h</span>\nFilesystem            Size  Used Avail Use% Mounted on\n/dev/sda1             <span class=\"token number\">4</span>.0G  <span class=\"token number\">1</span>.8G  <span class=\"token number\">2</span>.0G  <span class=\"token number\">48</span>% /\nnone                  299M  136K  298M   <span class=\"token number\">1</span>% /dev/shm\n/opt/xensource/packages/iso/XenCenter.iso\n                       56M   56M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /var/xen/xc-install\n/dev/mapper/VG_XenStorage--cd27bd82--61d4--1bb3--e5b6--1a1e9c57c7eb-test\n                     1008G  200M  957G   <span class=\"token number\">1</span>% /mnt/test</code></pre></div>\n<p>정상적으로 마운트 되었다. 이제 마지막으로 이 파티션을 XenServer의 Storage로 등록해야 한다.</p>\n<p><code class=\"language-text\">xe sr-create</code>를 이용하여 Storage를 등록한다. type=<strong>iso</strong>이며, device-config:<strong>location=</strong>을 통하여 경로를 지정하고, device-config:legacy_mode를 <strong>true</strong>로 하고 content-type을 <strong>iso</strong>로 하게되었는데, 이 옵션들의 자세한 내용은 잘 모르겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># xe sr-create name-label=ISOimages type=iso device-config:location=/mnt/test/ device-config:legacy_mode=true content-type=iso</span></code></pre></div>\n<p>이렇게 등록을 하게되면 ISO Storage가 정상적으로 등록이 된다. XenCenter를 이용할 경우 파일을 넣은 후 Rescan을 하여야 반영이 되고, XenServer를 다시 시작할 경우, vgchange를 하여야 정상적으로 목록에 뜨게 된다.</p>\n<p>이를 자동으로 등록하기 위해서는 <code class=\"language-text\">/etc/fstab</code>파일에 등록하면 된다.</p>","frontmatter":{"categories":["Server"],"title":"XenServer Local ISO repository","date":"Sep 02, 2015","tags":["XenServer","LVM"]}}},"pageContext":{"comments":true,"previous":{"frontmatter":{"path":"/articles/2015-07/FTZ-level4","title":"FTZ Level4","comments":true}},"next":{"frontmatter":{"path":"/articles/2015-09/Fedora-Core-3-repositories","title":"Fedora Core 3 repositories","comments":true}}}}}